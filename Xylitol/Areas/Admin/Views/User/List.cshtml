@{

}

@section Styles{
    <!--è¡¨æ ¼æ’ä»¶css-->
    <link rel="stylesheet" href="~/lib/bootstrap-table/bootstrap-table.css">
}
<div class="container-fluid">

    <div class="row">

        <div class="col-lg-12">
            <div class="card">
                <header class="card-header">
                    <div class="card-title">ç”¨æˆ·åˆ—è¡¨</div>
                </header>
                <div class="card-body">
                    @* å·¥å…·æ  *@
                    <div id="toolbar" class="toolbar-btn-action">
                        <button id="btn_add" type="button" class="btn btn-primary me-1">
                            <span class="mdi mdi-plus" aria-hidden="true"></span>æ–°å¢
                        </button>
                        <button id="btn_enable" type="button" class="btn btn-success me-1">
                            <span class="mdi mdi-check" aria-hidden="true"></span>å¯ç”¨
                        </button>
                        <button id="btn_disable" type="button" class="btn btn-warning me-1">
                            <span class="mdi mdi-block-helper" aria-hidden="true"></span>ç¦ç”¨
                        </button>
                        <button id="btn_delete" type="button" class="btn btn-danger">
                            <span class="mdi mdi-window-close" aria-hidden="true"></span>åˆ é™¤
                        </button>
                    </div>
                    @* è¡¨æ ¼ä¸»ä½“ *@
                    <table id="table" style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap"></table>
                </div>
            </div>
        </div>

    </div>

</div>




@section Scripts{
    <script src="~/lib/bootstrap-table/bootstrap-table.js"></script>
    <script src="~/lib/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="~/lib/layer/layer.min.js"></script>
    <script type="text/javascript" src="~/js/main.min.js" asp-append-version="true"></script>
    
    <script>

        /**
         * åˆ†é¡µç›¸å…³çš„é…ç½®
         **/
        const pagination = {
            // åˆ†é¡µæ–¹å¼ï¼š[client] å®¢æˆ·ç«¯åˆ†é¡µï¼Œ[server] æœåŠ¡ç«¯åˆ†é¡µ
            sidePagination: "server",
            // åˆå§‹åŒ–åŠ è½½ç¬¬ä¸€é¡µï¼Œé»˜è®¤ç¬¬ä¸€é¡µ
            pageNumber: 1,
            // æ¯é¡µçš„è®°å½•è¡Œæ•°
            pageSize: 10,
            // å¯ä¾›é€‰æ‹©çš„æ¯é¡µçš„è¡Œæ•° - (äº²æµ‹å¤§äº1000å­˜åœ¨æ¸²æŸ“é—®é¢˜)
            pageList: [10, 20, 50, 100],
            // åœ¨ä¸Šç™¾é¡µçš„æƒ…å†µä¸‹ä½“éªŒè¾ƒå¥½ - èƒ½å¤Ÿæ˜¾ç¤ºé¦–å°¾é¡µ
            paginationLoop: true,
            // å±•ç¤ºé¦–å°¾é¡µçš„æœ€å°é¡µæ•°
            paginationPagesBySide: 2
        };

        /**
         * æŒ‰é’®ç›¸å…³é…ç½®
         **/
        const button = {
            // æŒ‰é’®çš„ç±»
            buttonsClass: 'default',
            // ç±»åå‰ç¼€
            buttonsPrefix: 'btn'
        }

        /**
         * å›¾æ ‡ç›¸å…³é…ç½®
         **/
        const icon = {
            // å›¾æ ‡å‰ç¼€
            iconsPrefix: 'mdi',
            // å›¾æ ‡å¤§å°
            iconSize: 'mini',
            // å›¾æ ‡çš„è®¾ç½®
            icons: {
                paginationSwitchDown: 'mdi-door-closed',
                paginationSwitchUp: 'mdi-door-open',
                refresh: 'mdi-refresh',
                toggleOff: 'mdi-toggle-switch-off',
                toggleOn: 'mdi-toggle-switch',
                columns: 'mdi-table-column-remove',
                detailOpen: 'mdi-plus',
                detailClose: 'mdi-minus',
                fullscreen: 'mdi-monitor-screenshot',
                search: 'mdi-table-search',
                clearSearch: 'mdi-trash-can-outline'
            }
        };

        /**
         * è¡¨æ ¼ç›¸å…³çš„é…ç½®
         **/
        const table = {
            classes: 'table table-bordered table-hover table-striped lyear-table',
            // è¯·æ±‚åœ°å€
            url: '@(Url.Action("GetUserList"))',
            // å”¯ä¸€IDå­—æ®µ
            uniqueId: 'userId',
            // æ¯è¡Œçš„å”¯ä¸€æ ‡è¯†å­—æ®µ
            idField: 'userAccount',
            // æ˜¯å¦å¯ç”¨ç‚¹å‡»é€‰ä¸­è¡Œ
            clickToSelect: true,
            // æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†è§†å›¾å’Œåˆ—è¡¨è§†å›¾çš„åˆ‡æ¢æŒ‰é’®(clickToSelectåŒæ—¶è®¾ç½®ä¸ºtrueæ—¶ç‚¹å‡»ä¼šæŠ¥é”™)
            // showToggle: true,
            // è¯·æ±‚å¾—åˆ°çš„æ•°æ®ç±»å‹
            dataType: 'json',
            // è¯·æ±‚æ–¹æ³•
            method: 'get',
            // å·¥å…·æŒ‰é’®å®¹å™¨
            toolbar: '#toolbar',
            // æ˜¯å¦åˆ†é¡µ
            pagination: true,
            // æ˜¯å¦æ˜¾ç¤ºæ‰€æœ‰çš„åˆ—
            showColumns: true,
            // æ˜¯å¦æ˜¾ç¤ºåˆ·æ–°æŒ‰é’®
            showRefresh: true,
            // æ˜¾ç¤ºå›¾æ ‡
            showButtonIcons: true,
            // æ˜¾ç¤ºæ–‡æœ¬
            showButtonText: false,
            // æ˜¾ç¤ºå…¨å±
            showFullscreen: true,
            // å¼€å…³æ§åˆ¶åˆ†é¡µ
            showPaginationSwitch: true,
            // æ€»æ•°å­—æ®µ
            totalField: 'total',
            dataField: "rows",
            responseHandler: function (res) {
                console.log(res)
                return res.data;
            },
            // å½“å­—æ®µä¸º undefined æ˜¾ç¤º
            undefinedText: 'ç©º',
            // æ’åºæ–¹å¼
            sortOrder: "asc",
            ...icon,
            ...pagination,
            ...button
        };

        /**
         * ç”¨äºæ¼”ç¤ºçš„åˆ—ä¿¡æ¯
         **/
        const columns = [
            { field: 'example', checkbox: true, width: 2, widthUnit: 'rem' },
            { field: 'userId', title: 'å”¯ä¸€Id', align: 'center', visible: false },
            { field: 'userAccount', align: 'center', title: 'ç”¨æˆ·å' },
            { field: 'nickName', align: 'center', title: 'æ˜µç§°' },
            { field: 'userName', align: 'center', title: 'å§“å' },
            { field: 'userGender', align: 'center', title: 'æ€§åˆ«', formatter: TagGender },
            { field: 'userPhone', align: 'center', title: 'ç”µè¯' },
            { field: 'userEmail', align: 'center', title: 'é‚®ä»¶' },
           // { field: 'userStatus', align: 'center', title: 'å‡ºç”Ÿæ—¥æœŸ' },
           // { field: 'address', align: 'center', title: 'åœ°å€' },
           // { field: 'signature', align: 'center', title: 'ç­¾å', visible: false },
            { field: 'userRemark', align: 'center', title: 'å¤‡æ³¨',formatter: CustomRemarks,cellStyle: RemarksCss},
           // { field: 'lastLoginDt', align: 'center', title: 'æœ€åç™»å½•æ—¶é—´', visible: false },
           // { field: 'lastLoginIp', align: 'center', title: 'æœ€åç™»å½•IP', visible: false },
           // { field: 'lastLoginDev', align: 'center', title: 'æœ€åç™»å½•è®¾å¤‡' , visible: false},
           // { field: 'createUid', align: 'center', title: 'åˆ›å»ºç”¨æˆ·UID', visible: false },
           // { field: 'createDt', align: 'center', title: 'åˆ›å»ºæ—¶é—´', visible: false},
           // { field: 'updateUid', align: 'center', title: 'æ›´æ–°ç”¨æˆ·', visible: false },
           // { field: 'updateDt', align: 'center', title: 'æ›´æ–°æ—¶é—´', visible: false },
            { field: 'userStatus', title: 'çŠ¶æ€', align: 'center',formatter: TagStatus },
            {
                field: 'operate', title: 'æ“ä½œ', align: 'center',
                formatter: btnGroup,  // è‡ªå®šä¹‰æ–¹æ³•
                events: {
                    'click .sel-btn': function (event, value, row, index) {
                        event.stopPropagation();
                        SelUser(row);
                    },
                    'click .edit-btn': function (event, value, row, index) {
                        event.stopPropagation();
                        editUser(row);
                    },
                    'click .del-btn': function (event, value, row, index) {
                        event.stopPropagation();
                        delUser(row);
                    }
                }
            }
        ];

        // è‡ªå®šä¹‰å¤‡æ³¨åˆ—æ ·å¼
        function RemarksCss(value, row, index, field) {
            return { css: { "min-width": "5rem", "white-space": "nowrap", "test-overflow": "ellipsis", "overflow": "hidden", "max-width": "10rem" } }
        }

        // è‡ªå®šä¹‰å¤‡æ³¨åˆ—
        function CustomRemarks(value, row, index) {
            let html =
                "<span data-bs-toggle='tooltip' data-bs-placement='bottom' style='display: block;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;' title=" + (value == null ? "ç©º" : value) + ">" + (value == null ? "ç©º" : value) + "</span>";
            return html;
        }

        // è‡ªå®šä¹‰æ€§åˆ«
        function TagGender(value, row, index) {
            var value = "";
            if (row.userGender == '0') {
                value = '<span class="badge bg-cyan">ç”·</span>';
            } else if (row.userGender == '1') {
                value = '<span class="badge bg-pink">å¥³</span>';
            } else {
                value = '<span">ğŸŒ¸</span>';
            }
            return value;
        }

        // è‡ªå®šä¹‰çŠ¶æ€
        function TagStatus(value, row, index) {
            console.log(row);
            var value = "";
            if (row.userStatus == '0') {
                value = '<span class="badge bg-success">æ­£å¸¸</span>';
            } else if (row.userStatus == '1') {
                value = '<span class="badge bg-danger">ç¦ç”¨</span>';
            } else {
                value = '<span class="badge bg-secondary">å°ç¦</span>';
            }
            return value;
        }

        // è‡ªå®šä¹‰æ“ä½œæŒ‰é’®
        function btnGroup() {
            let html =
                '<a href="#!" class="btn btn-sm btn-info me-1 sel-btn" title="æŸ¥çœ‹" data-bs-toggle="tooltip"><i class="mdi mdi-account-eye-outline"></i></a>' +
                '<a href="#!" class="btn btn-sm btn-warning me-1 edit-btn" title="ç¼–è¾‘" data-bs-toggle="tooltip"><i class="mdi mdi-account-edit-outline"></i></a>' +
                '<a href="#!" class="btn btn-sm btn-danger me-1 del-btn" title="åˆ é™¤" data-bs-toggle="tooltip"><i class="mdi mdi-account-remove-outline"></i></a>';
            return html;
        }

        // æ“ä½œæ–¹æ³• - æŸ¥çœ‹
        function SelUser() {
            $('.btn.save-btn').attr("disabled", true);
            $('#UserInfoModal').find('.modal-title span').text('æŸ¥çœ‹');
            userInfoModal = new bootstrap.Modal($('#UserInfoModal').get(0), {
                keyboard: false,
                backdrop: 'static',
            });
            userInfoModal.show();
        }
        // æ“ä½œæ–¹æ³• - ç¼–è¾‘
        function editUser(row) {
            xy.openTab(
                {
                    title: "ç¼–è¾‘ç”¨æˆ·",
                    url: "@Url.Action("Edit","User")?userId=" + row.userId,
                    fromurl: "@Url.Action("List","User")",
                    show: true
                }
            );
        }
        // æ“ä½œæ–¹æ³• - åˆ é™¤
        function delUser() {
            alert('ä¿¡æ¯åˆ é™¤æˆåŠŸ');
        }

        $('table').bootstrapTable({
            ...table,
            // è‡ªå®šä¹‰çš„æŸ¥è¯¢å‚æ•°
            queryParams: function (params) {
                return {
                    // æ¯é¡µæ•°æ®é‡
                    limit: params.limit,
                    // sqlè¯­å¥èµ·å§‹ç´¢å¼•
                    offset: params.offset,
                    page: (params.offset / params.limit) + 1,
                    // æ’åºçš„åˆ—å
                    sort: params.sort,
                    // æ’åºæ–¹å¼ 'asc' 'desc'
                    sortOrder: params.order
                };
            },
            columns,
            onLoadSuccess: function (data) {
                $("[data-bs-toggle='tooltip']").tooltip();
            }

        });

        $(document).on('click', '#btn_add', function () {
            //OpenTab('æ–°å¢ç”¨æˆ·', '@(Url.Action("Add", "User"))', '@(Url.Action("List"))', true);
            xy.openTab(
                {
                    title: "æ–°å¢ç”¨æˆ·",
                    url: "@Url.Action("Add","User")",
                    fromurl: "@Url.Action("List","User")"
                }
            );
        });

        /**
         * å¯ç”¨ç”¨æˆ·æŒ‰é’®äº‹ä»¶
         */
        $(document).on('click', '#btn_enable', function () {
            alert("å¯ç”¨ç”¨æˆ·");
        });

        /**
         * ç¦ç”¨ç”¨æˆ·æŒ‰é’®äº‹ä»¶
         */
        $(document).on('click', '#btn_disable', function () {
            alert("ç¦ç”¨ç”¨æˆ·");
        });

        /**
         * åˆ é™¤ç”¨æˆ·æŒ‰é’®äº‹ä»¶
         */
        $(document).on('click', '#btn_delete', '.del-btn', function () {
            alert("åˆ é™¤ç”¨æˆ·");
        });


    </script>
}